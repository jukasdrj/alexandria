# Plans Directory Setup

**Date:** January 16, 2026
**Claude Code Version:** 2.1.9+

## Overview

This directory is configured to work with Claude Code's native `plansDirectory` setting (v2.1.9+). Alexandria does NOT have the planning-with-files plugin installed, so planning files are managed through:
1. **Claude Code's native plan mode** (this directory)
2. **Domain-specific skills** (auto-load planning when needed)

## Configuration Applied

### 1. Settings (.claude/settings.json)
```json
{
  "plansDirectory": ".claude/plans"
}
```

This tells Claude Code to store plan files generated by native plan mode in `.claude/plans/` instead of the project root.

### 2. Git Ignore (.gitignore)
```gitignore
# Claude Code plans directory (session-specific, except README)
.claude/plans/*
!.claude/plans/README.md
!.claude/plans/SETUP.md
```

Planning files are session-specific and should not be committed.

### 3. Directory Structure
```
.claude/plans/
├── README.md    # Documentation (tracked in git)
├── SETUP.md     # This file (tracked in git)
└── [planning files created during sessions - ignored by git]
```

## How Planning Works in Alexandria

### Native Claude Code Plan Mode
When you use plan mode, Claude will create plan files here automatically:
- Files are stored in `.claude/plans/`
- Ignored by git (except docs)
- Format determined by Claude Code

### Domain-Specific Skills (Recommended)
Alexandria provides specialized skills that auto-load planning:

**Available Skills:**
- **`/schema-migration`** - Database schema changes
  - Auto-loads: planning-with-files, postgres-optimizer agent
  - Use for: Adding columns, creating indexes, data migrations

- **`/api-integration`** - External API providers
  - Auto-loads: planning-with-files
  - Use for: Integrating ISBNdb, Google Books, LibraryThing, etc.

- **`/queue-optimization`** - Queue performance tuning
  - Auto-loads: planning-with-files, cloudflare-workers-optimizer agent
  - Use for: Batch sizes, concurrency, handler optimization

**Skill Features:**
- Auto-load expert agents when needed
- Create planning files (task_plan.md, findings.md, progress.md)
- Run validation hooks (db-check.sh, queue-status)
- Execute in forked contexts for isolation

## Planning File Locations

### This Directory (.claude/plans/)
- **Native plan mode** files (when you enable plan mode)
- Session-specific
- Git-ignored

### Project Root
- **Skill-based planning files** (task_plan.md, findings.md, progress.md)
- Created by domain skills
- Also git-ignored (see root .gitignore lines 43-46)

Both approaches work! Use whichever fits your workflow.

## Usage Recommendations

### For Database Work
```bash
# Use schema-migration skill
/schema-migration
```
This automatically:
1. Loads postgres-optimizer agent
2. Creates planning files
3. Runs db-check.sh validation
4. Provides expert guidance

### For API Integration
```bash
# Use api-integration skill
/api-integration
```
This automatically:
1. Creates planning files
2. Runs in forked context
3. Validates circuit breakers
4. Enforces rate limiting patterns

### For Queue Optimization
```bash
# Use queue-optimization skill
/queue-optimization
```
This automatically:
1. Loads cloudflare-workers-optimizer agent
2. Creates planning files
3. Analyzes queue metrics
4. Provides tuning recommendations

### For General Planning
Just enable Claude Code's native plan mode and files will be created here automatically.

## Benefits

✅ **Organized:** Plans in dedicated directory, not cluttering root
✅ **Clean Git:** Session files never committed
✅ **Flexible:** Works with both native plan mode and domain skills
✅ **Documented:** README explains the system
✅ **Expert Guidance:** Skills auto-load specialized agents when needed

## Project-Specific Considerations

**Alexandria Context:**
- Database is read-only (OpenLibrary is source of truth)
- Always test queries in psql first
- 54M+ editions, 40M+ works, 14.7M authors
- Use `edition_isbns` table for ISBN lookups (49.3M rows, indexed)
- Consider quota limits (ISBNdb: 13K/day)
- Check queue architecture for async operations

**When Planning:**
1. Start with skill if domain-specific (/schema-migration, /api-integration, /queue-optimization)
2. Use native plan mode for general planning
3. Always read `CLAUDE.md` for project context
4. Check `docs/INDEX.md` for relevant documentation

## Related Documentation

- **Claude Code Docs:** https://code.claude.com/docs/en/
- **Skills:** `.claude/skills/` - Domain-specific planning workflows
- **Agents:** `.claude/agents/` - Specialized expert agents
- **Project Guide:** `CLAUDE.md` - Complete Alexandria documentation
- **Docs Index:** `docs/INDEX.md` - All documentation navigation

---

**Configured by:** Claude Code Session
**Tested with:** Claude Code 2.1.9
